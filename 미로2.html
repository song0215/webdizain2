<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>1ì¸ì¹­ ë¯¸ë¡œ ì¤‘ì•™ ì •ë ¬ ë²„ì „</title>
<style>
    body {
        background: #222;
        color: white;
        font-family: sans-serif;
        text-align: center;
        padding-top: 18vh;
    }

    /* ====== ë„¤ëª¨ ê²Œì„ í™”ë©´ ====== */
    #view {
    width: 400px;  /* ğŸ”¥ ì—¬ê¸°ë§Œ ë°”ê¾¸ë©´ ì „ì²´ ìŠ¤ì¼€ì¼ ë³€í™” */
    aspect-ratio: 1 / 1;
    background: #111;
    border: 0.2vw solid #444;
    margin: 0 auto;
    position: relative;
    overflow: hidden;
    border-radius: 1vw;
}

    /* ====== ë¬¸ ê³µí†µ ìŠ¤íƒ€ì¼ ====== */
    .door {
    position: absolute;
    object-fit: cover;
    cursor: pointer;
    transition: transform 0.15s ease, filter 0.15s ease;
    user-select: none;
}

/* ì •ë©´(front) â€” ì¤‘ì•™ ìœ„ */
#frontDoor {
    width: 42%;
    height: 50%;
    left: 50%;
    top: 32%;
    transform: translate(-50%, -50%);
}

/* ì™¼ìª½(left) â€” ë” ì™¼ìª½ì— ë¶™ì„ */
#leftDoor {
    width: 30%;
    height: 44%;
    left: 2%;
    top: 62%;
    transform: translateY(-50%);
}

/* ì˜¤ë¥¸ìª½(right) â€” ë” ì˜¤ë¥¸ìª½ì— ë¶™ì„ */
#rightDoor {
    width: 30%;
    height: 44%;
    right: 2%;
    top: 62%;
    transform: translateY(-50%);
}

.door:hover {
    transform: scale(1.05);
    filter: brightness(1.15);
}
    /* ====== ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ====== */
#backBtn {
    position: absolute;
    bottom: 3%;
    left: 50%;
    transform: translateX(-50%);
    padding: 0.6em 1.2em;   /* ğŸ”¥ í…ìŠ¤íŠ¸ ê¸°ë°˜ í¬ê¸° â†’ í…ìŠ¤ì²˜ ìœ ì§€ */
    background: rgba(0,0,0,0.6);
    color: white;
    border: none;
    border-radius: 8px;     /* ë‘¥ê·¼ ëª¨ì„œë¦¬ ìœ ì§€ */
    cursor: pointer;
    font-size: clamp(10px, 1.2vw, 20px); /* ë°˜ì‘í˜• í°íŠ¸(ê³¼ë„í•œ ë³€í™” ë°©ì§€) */
    backdrop-filter: blur(3px); /* ğŸ”¥ ìœ ë¦¬ ëŠë‚Œ */
    transition: background 0.2s, transform 0.2s;
}

#backBtn:hover {
    background: rgba(0,0,0,0.8);
    transform: translateX(-50%) scale(1.05); /* ì‚´ì§ í™•ëŒ€ ì›ë˜ ëŠë‚Œ */
}

    /* ====== ì „ì²´ ë¯¸ë¡œ ì§€ë„ ====== */
    #map {
    margin-top: 30px;
    display: grid;
    gap: 2px;
    width: 440px;        /* ë” í¼ */
    height: 440px;       /* ë” í¼ */
    overflow: auto;      /* ë¯¸ë¡œê°€ ì»¤ì§€ë©´ ìŠ¤í¬ë¡¤ */
    border: 3px solid #555;
    background: #000;
    padding: 5px;

    position: fixed;
    right: 20px;
    top: 20px;
}
.cell {
    width: 20px;
    height: 20px;
    background: #666;
}
.wall { background: #222; }
.player { background: yellow; }
</style>
</head>
<body>

<h2>1ì¸ì¹­ ë¯¸ë¡œ</h2>

<div id="view">
    <img id="frontDoor" class="door">
    <img id="leftDoor" class="door">
    <img id="rightDoor" class="door">

    <button id="backBtn" onclick="goBack()">ë’¤ë¡œê°€ê¸°</button>
</div>

<h3>ì „ì²´ ë¯¸ë¡œ</h3>
<div id="map"></div>

<button id="toggleMapBtn" style="position:fixed; right:20px; bottom:20px;">ë¯¸ë‹ˆë§µ í† ê¸€</button>

<script>
    let facing = "N";
    const turnLeft  = { N:"W", W:"S", S:"E", E:"N" };
const turnRight = { N:"E", E:"S", S:"W", W:"N" };

let history = [];

/* ==== ë¯¸ë¡œ ë°ì´í„° ==== */
const maze = {
    "0,0": { N:"0,1", S:null, W:null, E:"1,0" },
    "0,1": { N:"0,2", S:"0,0", W:null, E:null },
    "1,0": { N:null, S:null, W:"0,0", E:"2,0" },
    "2,0": { N:"2,1", S:"2,-1", W:null, E:"3,0" },
    "3,0": { N:null, S:null, W:"2,0", E:"EXIT" },
    "2,1": { N:"2,2", S:"2,0", W:null, E:null },
    "2,2": { N:null, S:"2,1", W:"1,2", E:null },
    "2,-1": { N:"2,0", S:null, W:null, E:null },
    "1,2": { N:null, S:null, W:"0,2", E:"2,2" },
    "0,2": { N:null, S:"0,1", W:null, E:"1,2" },
    "10,10": { N:null, S:null, W:null, E:null },
    
};

let px = 0, py = 0;
let historyStack = [];

const imgOpen  = "https://via.placeholder.com/600x800/6b8/fff?text=OPEN";
const imgClose = "https://via.placeholder.com/600x800/333/fff?text=BLOCKED";

// ğŸ”¥ [ì¶”ê°€] ì¶œêµ¬ ì´ë¯¸ì§€ì™€ ì´ë™í•  í˜ì´ì§€ ì£¼ì†Œ
const imgExit  = "https://via.placeholder.com/600x800/f80/fff?text=EXIT+DOOR"; 
const exitUrl  = "https://www.google.com"; // ì´ë™í•  ì„ì‹œ í˜ì´

const viewMap = {
    N: { front: "N", left: "W", right: "E" }, // ë¶ìª½ ë³¼ ë•Œ: ì¢Œ=ì„œ, ìš°=ë™ (ì •ìƒ)
    S: { front: "S", left: "E", right: "W" }, // ë‚¨ìª½ ë³¼ ë•Œ: ì¢Œ=ë™, ìš°=ì„œ (ì •ìƒ)
    
    // ğŸ‘‡ ì—¬ê¸°ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤ (ê¸°ì¡´ê³¼ ë°˜ëŒ€ë¡œ ë³€ê²½)
    E: { front: "E", left: "N", right: "S" }, // ë™ìª½ ë³¼ ë•Œ: ì¢Œ=ë¶, ìš°=ë‚¨
    W: { front: "W", left: "S", right: "N" }  // ì„œìª½ ë³¼ ë•Œ: ì¢Œ=ë‚¨, ìš°=ë¶
};

/* ==== ë¬¸ ì—…ë°ì´íŠ¸ ==== */
function updateDoors() {
    const room = maze[`${px},${py}`];
    const map = viewMap[facing];

    setDoor(frontDoor, room[map.front]);
    setDoor(leftDoor, room[map.left]);
    setDoor(rightDoor, room[map.right]);
}

function setDoor(doorImg, nextRoom) {
    // ğŸ”¥ [ìˆ˜ì •] nextRoomì´ "EXIT"ì¸ ê²½ìš° ì²˜ë¦¬ ì¶”ê°€
    if (nextRoom === "EXIT") {
        doorImg.src = imgExit;       // ì¶œêµ¬ ì „ìš© ì´ë¯¸ì§€
        doorImg.style.opacity = 1;
        doorImg.style.pointerEvents = "auto";
    } 
    else if (nextRoom) {
        doorImg.src = imgOpen;       // ì¼ë°˜ ê¸¸ ì´ë¯¸ì§€
        doorImg.style.opacity = 1;
        doorImg.style.pointerEvents = "auto";
    } 
    else {
        doorImg.src = imgClose;      // ë²½ ì´ë¯¸ì§€
        doorImg.style.opacity = 0.25;
        doorImg.style.pointerEvents = "none";
    }
}

/* ==== ì´ë™ + ë’¤ë¡œê°€ê¸° ìŠ¤íƒ ==== */
function moveTo(coord, dir) {
    if (!coord) return; // ì´ë™ ë¶ˆê°€ë©´ ë°©í–¥ë„ ë°”ê¾¸ì§€ ì•ŠìŒ

// ğŸ”¥ [ì¶”ê°€] "EXIT"ë¥¼ í´ë¦­í•˜ë©´ í˜ì´ì§€ ì´ë™!
    if (coord === "EXIT") {
        alert("ì¶•í•˜í•©ë‹ˆë‹¤! ë¯¸ë¡œë¥¼ íƒˆì¶œí•©ë‹ˆë‹¤."); // (ì„ íƒì‚¬í•­) ì•Œë¦¼ì°½
        window.location.href = exitUrl;        // í˜ì´ì§€ ì´ë™
        return;
    }

    history.push({ x: px, y: py, facing });

    const [nx, ny] = coord.split(",").map(Number);
    px = nx;
    py = ny;

    facing = dir; // ì´ë™ ì„±ê³µí•œ ê²½ìš°ì—ë§Œ ë°©í–¥ ë³€ê²½

    updateDoors();
    drawMap();
}

function goBack() {
    if (history.length === 0) return;

    const last = history.pop();
    px = last.x;
    py = last.y;
    facing = last.facing;

    updateDoors();
    drawMap();
}
const opposite = { N:"S", S:"N", E:"W", W:"E" };



/* ==== ë¬¸ í´ë¦­ ==== */
document.getElementById("frontDoor").onclick = () => {
    const dir = viewMap[facing].front;
    moveTo(maze[`${px},${py}`][dir], dir);
};
document.getElementById("leftDoor").onclick = () => {
    const dir = viewMap[facing].left;
    moveTo(maze[`${px},${py}`][dir], dir);
};
document.getElementById("rightDoor").onclick = () => {
    const dir = viewMap[facing].right;
    moveTo(maze[`${px},${py}`][dir], dir);
};

/* ==== ì „ì²´ë§µ ==== */
function drawMap() {
    const map = document.getElementById("map");

    const coords = Object.keys(maze).map(k => k.split(",").map(Number));
    const xs = coords.map(c => c[0]);
    const ys = coords.map(c => c[1]);

    const minX = Math.min(...xs);
    const maxX = Math.max(...xs);
    const minY = Math.min(...ys);
    const maxY = Math.max(...ys);

    const width = maxX - minX + 1;
    const height = maxY - minY + 1;

    // ë¯¸ë‹ˆë§µ ì´ˆê¸°í™”
    map.innerHTML = "";

    // ë¯¸ë¡œë¥¼ ì¤‘ì•™ ì •ë ¬ì‹œí‚¤ê¸° ìœ„í•œ ì—¬ë°± ê³„ì‚°
    const paddingX = Math.floor((20 - width) / 2);
    const paddingY = Math.floor((20 - height) / 2);

    const gridX = Math.max(width, 20);
    const gridY = Math.max(height, 20);

    map.style.gridTemplateColumns = `repeat(${gridX}, 20px)`;

    for (let y = 0; y < gridY; y++) {
        for (let x = 0; x < gridX; x++) {
            const div = document.createElement("div");
            div.classList.add("cell");

            // ë¯¸ë¡œì˜ ì‹¤ì œ ì¢Œí‘œì— í•´ë‹¹í•˜ëŠ” ìœ„ì¹˜ì¸ì§€ ê³„ì‚°
            const realX = x - paddingX + minX;
            const realY = maxY - (y - paddingY);

            if (!maze[`${realX},${realY}`]) {
                div.classList.add("wall");
            }
            if (px === realX && py === realY) {
                div.classList.add("player");
            }
            map.appendChild(div);
        }
    }
}

document.getElementById("toggleMapBtn").onclick = () => {
    const map = document.getElementById("map");
    map.style.display = (map.style.display === "none") ? "grid" : "none";
};

updateDoors();
drawMap();
</script>

</body>
</html>